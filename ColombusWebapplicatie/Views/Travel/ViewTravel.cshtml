@model ColombusWebapplicatie.Models.Travel.Travel

@{
    ViewBag.Title = "Reisoverzicht";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


    @if (Model.Locations.Count > 0)
    {
        <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&signed_in=true"></script>
        <script>
            var markers = [];
            var infoWindows = [];
            function initialize() {
                var mapCanvas = document.getElementById('map-canvas');
                var mapOptions = {
                    mapTypeId: google.maps.MapTypeId.ROADMAP,
                    scrollwheel: false
                }
                var map = new google.maps.Map(mapCanvas, mapOptions)
                var markerId = 0;
                var latLngBounds = new google.maps.LatLngBounds();
                @foreach (var location in Model.Locations)
                {
                    <text>
                infoWindows[markerId] = new google.maps.InfoWindow({
                    content: "<h4>@location.LocationDetails.Name</h4>"
                    +"@(location.LocationDetails.Address.IsEmpty()==false?Html.Raw("<div>"+location.LocationDetails.Address+"</div>"):Html.Raw(""))"
                    +"@(location.LocationDetails.PhoneNumber.IsEmpty()==false?Html.Raw("<div>"+location.LocationDetails.PhoneNumber+"</div>"):Html.Raw(""))"
                });
                markers[markerId] = new google.maps.Marker({
                    id: markerId,
                    position: new google.maps.LatLng(@location.LocationDetails.Coordinates.Latitude, @location.LocationDetails.Coordinates.Longitude),
                    title: "@Html.Raw(location.LocationDetails.Name)"
                });
                markers[markerId].setMap(map);
                latLngBounds.extend(markers[markerId].position);
                google.maps.event.addListener(markers[markerId], 'click', function() {
                    infoWindows[this.id].open(map,markers[this.id]);
                });
                markerId++;
                </text>
                }
                map.setCenter(latLngBounds.getCenter());
                map.fitBounds(latLngBounds);
            }
            google.maps.event.addDomListener(window, 'load', initialize);
        </script>
        <div id="map-canvas"></div> <!-- Google Maps -->

    }
    <div class="orange-block">
        <div class="container">
            <h2>@Model.Title</h2>
        </div>

        <table cellpadding="0" cellspacing="0">
            <tr>
                <th style="padding:1em">Begindatum</th>
                <td style="padding:1em"> @Model.StartDate.Day-@Model.StartDate.Month-@Model.StartDate.Year</td>
            </tr>
            <tr>
                <th style="padding:1em">Einddatum</th>
                <td style="padding:1em"> @Model.EndDate.Day-@Model.EndDate.Month-@Model.EndDate.Year</td>
            </tr>
        </table>


        <h2>Locaties</h2>


    </div>

    @if (Model.Locations.Count > 0)
    {
        foreach (var location in Model.Locations)
        {
            <div class="white-block location">
                <h2>@location.LocationDetails.Name</h2>
                <div class="container">
                    <table cellpadding="0" cellspacing="0">
                        @if (!location.LocationDetails.Name.IsEmpty())
                        {
                            <tr>
                                <th style="padding:1em">Naam</th>
                                <td style="padding:1em">@location.LocationDetails.Name</td>
                            </tr>
                        }

                        @if (!location.LocationDetails.Address.IsEmpty())
                        {
                            <tr><td></td><td></td></tr>
                            <tr>
                                <th style="padding:1em">Adres</th>
                                <td style="padding:1em">@location.LocationDetails.Address</td>
                            </tr>
                        }
                        @if (!location.LocationDetails.PhoneNumber.IsEmpty())
                        {
                            <tr>
                                <th style="padding:1em">Telefoonnummer</th>
                                <td style="padding:1em">@location.LocationDetails.PhoneNumber</td>
                            </tr>
                        }
                        @if (!location.Note.IsEmpty())
                        {
                            <tr>
                                <th style="padding:1em">Notitie's</th>
                                <td style="padding:1em">@location.Note</td>
                            </tr>
                        }
                        else
                        {
                            //Temporary note
                            @Html.ActionLink("Notie toevoegen", "CreateNote", new { travelID = Model.ID, locationID = location.ID, note = "Bedrijfsuitje" }, new { @class = "button orange float left" })
                        }

                    </table>
                    <table cellpadding="0" cellspacing="0">
                        <tr>
                            <td style="width:50%">
                                @Html.ActionLink("Bekijk locatie", "ViewLocation", "Travel", new { travelID = Model.ID, placeID = location.LocationDetails.PlaceID }, new { @class = "button white" })
                            </td>
                            <td style="width:50%">
                                @Html.ActionLink("Verwijder locatie", "DeleteLocation", "Travel", new { travelID = Model.ID, locationID = location.ID }, new { @class = "button white", @style = "border-left:0;" })
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        }
    }
    <div class="container">
        <div class="white-block">
            @Html.ActionLink("Locatie Toevoegen", "SearchLocation", new { travelID = Model.ID }, new { @class = "button orange float left" })
            @using (Html.BeginForm("CreateTravelogue", "Travelogue", new { travelID = Model.ID }))
            {
                <input type="submit" value="Nieuw verslag aanmaken" class="button orange float right" />
            }
        </div>
    </div>